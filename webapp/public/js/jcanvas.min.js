/*
 jCanvas
Copyright 2012, Caleb Evans
Licensed under the MIT license
*/
(function(d,R,V,P,W,v,F,i,A){function B(){}function C(b){b?z(X,b):C.prefs=X=B.prototype=z({},N);return this}function I(b,a){b.fillStyle=a.fillStyle;b.strokeStyle=a.strokeStyle;b.lineWidth=a.strokeWidth;a.rounded?(b.lineCap="round",b.lineJoin="round"):(b.lineCap=a.strokeCap,b.lineJoin=a.strokeJoin,b.miterLimit=a.miterLimit);b.shadowOffsetX=a.shadowX;b.shadowOffsetY=a.shadowY;b.shadowBlur=a.shadowBlur;b.shadowColor=a.shadowColor;b.globalAlpha=a.opacity;b.globalCompositeOperation=a.compositing}function y(b){return b&&
b.getContext?b.getContext("2d"):i}function L(b,a){a.closed&&b.closePath();b.fill();"transparent"!==a.fillStyle&&(b.shadowColor="transparent");b.stroke();a.closed||b.closePath();a._toRad&&b.restore();a.mask&&(a.autosave&&b.save(),b.clip())}function Y(b,a){a.translate&&(a.translateX=a.translateY=a.translate);b.translate(a.translateX,a.translateY)}function Z(b,a){1!==a.scale&&(a.scaleX=a.scaleY=a.scale);b.translate(a.x,a.y);b.scale(a.scaleX,a.scaleY);b.translate(-a.x,-a.y)}function $(b,a){a._toRad=a.inDegrees?
D/180:1;b.translate(a.x,a.y);b.rotate(a.rotate*a._toRad);b.translate(-a.x,-a.y)}function H(b,a,c,e,h){c._toRad=c.inDegrees?D/180:1;a.save();h=h||e;!b&&!c.fromCenter&&(c.x+=e/2,c.y+=h/2);(c.rotate||c.angle)&&$(a,c);(1!==c.scale||1!==c.scaleX||1!==c.scaleY)&&Z(a,c);(c.translate||c.translateX||c.translateY)&&Y(a,c)}function S(b){b.draggable&&(b.translateX+=b.x,b.translateY+=b.y)}function Q(b){var a;E.elem===b?a=E.data:((a=d.data(b,"jCanvas"))||(a=d.data(b,"jCanvas",{layers:[],intersects:[],drag:{},event:{}})),
E.elem=b,E.data=a);return a}function aa(b,a,c){c&&c.visible&&(c.method===d.fn.draw?c.fn.call(b[0],a):c.method&&c.method.call(b,c))}function G(b,a,c){var e,h,f,s="function"===typeof a,n,a=a||{};if(a.layer&&!a._layer){e=d(b);h=e.getLayers();s&&(a={method:d.fn.draw,fn:a});a=z(new B,a);if(!s){a.method=d.fn[a.method]||c;n=Q(b);for(f in C.events)C.events.hasOwnProperty(f)&&a[f]&&(C.events[f](e,n),a._event=v);if(a.draggable||a.cursor){a._event=v;b=["mousedown","mousemove","mouseup"];for(c=0;c<b.length;c+=
1)f=b[c],C.events[f](e,n);n.mouseout||(e.bind("mouseout.jCanvas",function(){n.drag={};e.drawLayers()}),n.mouseout=v)}}a.layer=v;a._layer=v;a.index===A&&(a.index=h.length);h.splice(a.index,0,a)}}function ba(b){var a;for(a=0;a<K.length;a+=1)b[K[a]]=b["_"+K[a]]}function ca(b,a){var c;for(c=0;c<K.length;c+=1)b["_"+K[c]]=b[K[c]],T[K[c]]=1,a&&delete b[K[c]]}function da(b){var a,c,e=[],h=1;b.match(/^#?\w+$/i)&&("transparent"===b&&(b="rgba(0,0,0,0)"),c=R.head,a=c.style.color,c.style.color=b,b=d.css(c,"color"),
c.style.color=a);b.match(/^rgb/i)&&(e=b.match(/\d+/gi),b.match(/%/gi)&&(h=2.55),e[0]*=h,e[1]*=h,e[2]*=h,e[3]=e[3]!==A?W(e[3]):1);return e}function ga(b){var a=3,c;"object"!==typeof b.start&&(b.start=da(b.start),b.end=da(b.end));b.now=[];if(1!==b.start[3]||1!==b.end[3])a=4;for(c=0;c<a;c+=1)b.now[c]=b.start[c]+(b.end[c]-b.start[c])*b.pos,3>c&&(b.now[c]=O(b.now[c]));1!==b.start[3]||1!==b.end[3]?b.now="rgba("+b.now.join(",")+")":(b.now.slice(0,3),b.now="rgb("+b.now.join(",")+")");b.elem.nodeName?b.elem.style[b.prop]=
b.now:b.elem[b.prop]=b.now}function M(b){C.events[b]=function(a,c){var e="mouseover"===b||"mouseout"===b?"mousemove":b,h=c.event;c[e]||(a.bind(e+".jCanvas",function(b){h.x=b.offsetX;h.y=b.offsetY;h.type=e;a.drawLayers(v);b.preventDefault()}),c[e]=v)}}function J(b,a,c){var b=Q(b),e=b.event,a=a.isPointInPath(e.x,e.y);c.mouseX=e.x;c.mouseY=e.y;!a&&(c._hovered&&!c._fired)&&(c._mousedout=v);a&&b.intersects.push(c)}function ea(b,a,c,e,h){var f=/\b(\d*\.?\d*)\w\w\b/gi,s;if(E.text===e.text&&E.font===e.font&&
E.maxWidth===e.maxWidth&&E.lineHeight===e.lineHeight)e.width=E.width,e.height=E.height;else if(!a){e.width=c.measureText(h[0]).width;for(a=1;a<h.length;a+=1)s=c.measureText(h[a]).width,s>e.width&&(e.width=s);c=b.style.fontSize;if(a=e.font.match(f))b.style.fontSize=e.font.match(f)[0];e.height=W(d.css(b,"fontSize"))*h.length*e.lineHeight;b.style.fontSize=c}}var N,X,z=d.extend,O=P.round,D=P.PI,fa=P.sin,U=P.cos,ha=d.event.fix,E={},K,T;d.fn.jCanvas=C;C.events={};N={align:"center",autosave:v,baseline:"middle",
bringToFront:F,ccw:F,closed:F,compositing:"source-over",cornerRadius:0,cropFromCenter:v,draggable:F,disableDrag:F,each:i,end:360,fillStyle:"transparent",font:"12pt sans-serif",fromCenter:v,height:i,inDegrees:v,lineHeight:1,load:i,mask:F,maxWidth:i,method:i,miterLimit:10,opacity:1,projection:0,r1:i,r2:i,radius:0,repeat:"repeat",rotate:0,rounded:F,scale:1,scaleX:1,scaleY:1,shadowBlur:0,shadowColor:"transparent",shadowX:0,shadowY:0,sHeight:i,sides:3,source:"",start:0,strokeCap:"butt",strokeJoin:"miter",
strokeStyle:"transparent",strokeWidth:1,sWidth:i,sx:i,sy:i,text:"",translate:0,translateX:0,translateY:0,visible:v,width:i,x:0,y:0};C();C.extend=function(b){C.defaults=N=z(N,b.props);C();b.name&&(d.fn[b.name]=function c(e){var h,f,s,d=z(new B,e);for(f=0;f<this.length;f+=1)if(h=this[f],s=y(h))G(h,e,c),I(s,d),b.fn.call(h,s,d);return this});return d.fn[b.name]};d.fn.getLayers=function(){var b=this[0];return!b||!b.getContext?[]:Q(b).layers};d.fn.getLayer=function(b){var a=this.getLayers(),c=d.type(b),
e,h;if(b&&b.layer)e=b;else if("number"===c)e=a[b];else for(h=0;h<a.length;h+=1)if(a[h].index=h,a[h].name===b||"regexp"===c&&a[h].name.match(b)){e=a[h];break}return e};d.fn.setLayer=function(b,a){var c,e;for(c=0;c<this.length;c+=1)e=d(this[c]).getLayer(b),z(e,a);return this};d.fn.removeLayer=function(b){var a,c,e;for(c=0;c<this.length;c+=1)a=d(this[c]),e=a.getLayers(),(a=a.getLayer(b))&&e.splice(a.index,1);return this};d.fn.removeLayers=function(){var b,a;for(b=0;b<this.length;b+=1)a=d(this[b]).getLayers(),
a.length=0;return this};d.fn.getLayerGroup=function(b){var a=this.getLayers(),c=d.type(b),e=[],h;if("array"===c)return b;for(h=0;h<a.length;h+=1)a[h].index=h,(a[h].group===b||"regexp"===c&&a[h].group.match(b))&&e.push(a[h]);return e};d.fn.setLayerGroup=function(b,a){var c,e,h;for(e=0;e<this.length;e+=1){c=d(this[e]);c=c.getLayerGroup(b);for(h=0;h<c.length;h+=1)z(c[h],a)}return this};d.fn.removeLayerGroup=function(b){var a,c;d.type(b);var e,h;if(b!==A)for(c=0;c<this.length;c+=1){a=d(this[c]);e=a.getLayers();
a=a.getLayerGroup(b);for(h=0;h<a.length;h+=1)e.splice(a[h].index,1)}return this};d.fn.drawLayer=function(b){var a,c,e,h;for(a=0;a<this.length;a+=1)e=d(this[a]),c=y(this[a]),h=e.getLayer(b),aa(e,c,h);return this};d.fn.drawLayers=function(b){var a,c,e,h,f,s,n,r;for(c=0;c<this.length;c+=1)if(a=d(this[c]),e=y(this[c])){e.clearRect(0,0,this[c].width,this[c].height);E.elem===this[c]?n=E.data:(n=Q(this[c]),E.elem=this[c],E.data=n);h=n.layers;for(s=0;s<h.length;s+=1)if(f=h[s],f.index=s,b&&(f._fired=F),aa(a,
e,f),f._mousedout)f._mousedout=F,f._fired=v,f._hovered=F,f.mouseout&&f.mouseout.call(this[c],f),f.cursor&&f._cursor&&a.css({cursor:f._cursor});f=n.intersects[n.intersects.length-1]||{};e=n.event;e=e.type;r=f[e];s=n.drag;if(f._event){if((f.mouseover||f.mouseout||f.cursor)&&!f._hovered&&!f._fired)f._fired=v,f._hovered=v,f.mouseover&&f.mouseover.call(this[c],f),f.cursor&&(f._cursor=a.css("cursor"),a.css({cursor:f.cursor}));r&&!f._fired&&(f._fired=v,r.call(this[c],f));f.draggable&&(!f.disableDrag&&"mousedown"===
e)&&(f.bringToFront&&(h.splice(f.index,1),f.index=h.push(f)),s.layer=f,s.dragging=v,s.startX=f.x,s.startY=f.y,s.endX=f.mouseX,s.endY=f.mouseY,f.dragstart&&f.dragstart.call(this[c],f))}if(s.layer&&(s.dragging&&"mouseup"===e&&(s.layer.dragstop&&s.layer.dragstop.call(this[c],s.layer),n.drag={}),s.dragging&&"mousemove"===e))s.layer.x=s.layer.mouseX-(s.endX-s.startX),s.layer.y=s.layer.mouseY-(s.endY-s.startY),s.layer.drag&&s.layer.drag.call(this[c],s.layer)}n.intersects=[];return this};d.fn.addLayer=function(b){var a,
c,b=b||{};for(a=0;a<this.length;a+=1)if(c=y(this[a]))b.layer=v,G(this[a],b);return this};K=["width","height","opacity","lineHeight"];T={};d.fn.animateLayer=function(){function b(a,b){return function(){ba(b);a.drawLayers();f[4]&&f[4].call(a[0],b)}}function a(a,b){return function(c,e){ba(b);a.drawLayers();f[5]&&f[5].call(a[0],c,e,b)}}var c,e,h,f=[].slice.call(arguments,0);"object"===typeof f[0]&&!f[0].layer&&f.unshift(0);"object"===typeof f[2]?(f.splice(2,0,f[2].duration||i),f.splice(3,0,f[3].easing||
i),f.splice(4,0,f[4].complete||i),f.splice(5,0,f[5].step||i)):(f[2]===A?(f.splice(2,0,i),f.splice(3,0,i),f.splice(4,0,i)):"function"===typeof f[2]&&(f.splice(2,0,i),f.splice(3,0,i)),f[3]===A)?(f[3]=i,f.splice(4,0,i)):"function"===typeof f[3]&&f.splice(3,0,i);f[1]=z({},f[1]);for(e=0;e<this.length;e+=1)if(c=d(this[e]),h=y(this[e]))if((h=c.getLayer(f[0]))&&h.method!==d.fn.draw)ca(h),ca(f[1],v),h.style=T,d(h).animate(f[1],{duration:f[2],easing:d.easing[f[3]]?f[3]:i,complete:b(c,h),step:a(c,h)});return this};
d.fn.animateLayerGroup=function(b){var a,c,e=[].slice.call(arguments,0),h,f;for(c=0;c<this.length;c+=1){a=d(this[c]);h=a.getLayerGroup(b);for(f=0;f<h.length;f+=1)a.animateLayer.apply(a,[h[f]].concat(e.slice(1)))}};d.fn.delayLayer=function(b,a){var c,e,a=a||0;for(c=0;c<this.length;c+=1)e=d(this[c]).getLayer(b),d(e).delay(a);return this};d.fn.delayLayerGroup=function(b,a){var c,e,h,f,a=a||0;for(e=0;e<this.length;e+=1){c=d(this[e]);h=c.getLayerGroup(b);for(f=0;f<h.length;f+=1)c.delayLayer.call(c,h[f],
a)}};d.fn.stopLayer=function(b,a){var c,e;for(c=0;c<this.length;c+=1)e=d(this[c]).getLayer(b),d(e).stop(a);return this};d.fn.stopLayerGroup=function(b,a){var c,e,h,f;for(e=0;e<this.length;e+=1){c=d(this[e]);h=c.getLayerGroup(b);for(f=0;f<h.length;f+=1)c.stopLayer.call(c,h[f],a)}};(function(b){var a;for(a=0;a<b.length;a+=1)d.fx.step[b[a]]=ga})("color backgroundColor borderColor borderTopColor borderRightColor borderBottomColor borderLeftColor fillStyle outlineColor strokeStyle shadowColor".split(" "));
M("click");M("dblclick");M("mousedown");M("mouseup");M("mousemove");M("mouseover");M("mouseout");d.event.fix=function(b){var a,b=ha.call(d.event,b);if(b.pageX!==A&&b.offsetX===A&&(a=d(b.target).offset()))b.offsetX=b.pageX-a.left,b.offsetY=b.pageY-a.top;return b};d.fn.draw=function a(c){var e,h,c=c||{};"function"===typeof c&&(c={fn:c});for(e=0;e<this.length;e+=1)if((h=y(this[e]))&&c.fn)G(this[e],c,a),c.fn.call(this[e],h);return this};d.fn.clearCanvas=function(a){for(var c,e=z(new B,a),a=0;a<this.length;a+=
1)if(c=y(this[a]))H(a,c,e,e.width,e.height),!e.x||!e.y||!e.width||!e.height?c.clearRect(0,0,this[a].width,this[a].height):c.clearRect(e.x-e.width/2,e.y-e.height/2,e.width,e.height);return this};d.fn.saveCanvas=function(){var a,c;for(a=0;a<this.length;a+=1)(c=y(this[a]))&&c.save();return this};d.fn.restoreCanvas=function(){var a,c;for(a=0;a<this.length;a+=1)(c=y(this[a]))&&c.restore();return this};d.fn.translateCanvas=function(a){for(var c,e=z(new B,a),a=0;a<this.length;a+=1)if(c=y(this[a]))e.autosave&&
c.save(),Y(c,e);return this};d.fn.scaleCanvas=function(a){for(var c,e=z(new B,a),a=0;a<this.length;a+=1)if(c=y(this[a]))e.autosave&&c.save(),Z(c,e);return this};d.fn.rotateCanvas=function(a){for(var c,e=z(new B,a),a=0;a<this.length;a+=1)if(c=y(this[a]))e.autosave&&c.save(),$(c,e);return this};d.fn.drawRect=function c(e){var h,f,d=z(new B,e),n,r,t,p,j;for(h=0;h<this.length;h+=1)if(f=y(this[h]))G(this[h],e,c),I(f,d),H(h,f,d,d.width,d.height),f.beginPath(),n=d.x-d.width/2,r=d.y-d.height/2,(j=d.cornerRadius)?
(d.closed=v,t=d.x+d.width/2,p=d.y+d.height/2,0>t-n-2*j&&(j=(t-n)/2),0>p-r-2*j&&(j=(p-r)/2),f.moveTo(n+j,r),f.lineTo(t-j,r),f.arc(t-j,r+j,j,3*D/2,2*D,F),f.lineTo(t,p-j),f.arc(t-j,p-j,j,0,D/2,F),f.lineTo(n+j,p),f.arc(n+j,p-j,j,D/2,D,F),f.lineTo(n,r+j),f.arc(n+j,r+j,j,D,3*D/2,F)):f.rect(n,r,d.width,d.height),d._event&&J(this[h],f,e),L(f,d);return this};d.fn.drawArc=function e(h){var f,d,n=z(new B,h),h=h||{};!n.inDegrees&&360===n.end&&(h.end=n.end=2*D);for(f=0;f<this.length;f+=1)if(d=y(this[f]))G(this[f],
h,e),I(d,n),H(f,d,n,2*n.radius),d.beginPath(),d.arc(n.x,n.y,n.radius,n.start*n._toRad-D/2,n.end*n._toRad-D/2,n.ccw),n._event&&J(this[f],d,h),L(d,n);return this};d.fn.drawEllipse=function h(f){var d,n,r=z(new B,f),t=4*r.width/3,p=r.height;r.closed=v;for(d=0;d<this.length;d+=1)if(n=y(this[d]))G(this[d],f,h),I(n,r),H(d,n,r,r.width,r.height),n.beginPath(),n.moveTo(r.x,r.y-p/2),n.bezierCurveTo(r.x-t/2,r.y-p/2,r.x-t/2,r.y+p/2,r.x,r.y+p/2),n.bezierCurveTo(r.x+t/2,r.y+p/2,r.x+t/2,r.y-p/2,r.x,r.y-p/2),r._event&&
J(this[d],n,f),L(n,r);return this};d.fn.drawPolygon=function f(d){var n,r,t=z(new B,d),p=2*D/t.sides,j=D/t.sides,l=j+D/2,m=t.radius*U(p/2),o,i,k;t.closed=v;for(n=0;n<this.length;n+=1)if(r=y(this[n])){G(this[n],d,f);I(r,t);H(n,r,t,2*t.radius);r.beginPath();for(k=0;k<t.sides;k+=1)o=t.x+O(t.radius*U(l)),i=t.y+O(t.radius*fa(l)),r.lineTo(o,i),t.projection&&(o=t.x+O((m+m*t.projection)*U(l+j)),i=t.y+O((m+m*t.projection)*fa(l+j)),r.lineTo(o,i)),l+=p;t._event&&J(this[n],r,d);L(r,t)}return this};d.fn.drawLine=
function s(d){var i,t,p=z(new B,d),j,l,m;for(i=0;i<this.length;i+=1)if(t=y(this[i])){G(this[i],d,s);I(t,p);S(p);H(i,t,p,0);j=1;for(t.beginPath();v;)if(l=p["x"+j],m=p["y"+j],l!==A&&m!==A)t.lineTo(l,m),j+=1;else break;p._event&&J(this[i],t,d);L(t,p)}return this};d.fn.drawQuad=function n(d){var i,p,j=z(new B,d),l,m,o,q,k;for(i=0;i<this.length;i+=1)if(p=y(this[i])){G(this[i],d,n);I(p,j);S(j);H(i,p,j,0);l=2;p.beginPath();for(p.moveTo(j.x1,j.y1);v;)if(m=j["x"+l],o=j["y"+l],q=j["cx"+(l-1)],k=j["cy"+(l-1)],
m!==A&&o!==A&&q!==A&&k!==A)p.quadraticCurveTo(q,k,m,o),l+=1;else break;j._event&&J(this[i],p,d);L(p,j)}return this};d.fn.drawBezier=function r(d){var p,j,i=z(new B,d),m,o,q,k,g,u,w,x;for(p=0;p<this.length;p+=1)if(j=y(this[p])){G(this[p],d,r);I(j,i);S(i);H(p,j,i,0);m=2;o=1;j.beginPath();for(j.moveTo(i.x1,i.y1);v;)if(q=i["x"+m],k=i["y"+m],g=i["cx"+o],u=i["cy"+o],w=i["cx"+(o+1)],x=i["cy"+(o+1)],q!==A&&k!==A&&g!==A&&u!==A&&w!==A&&x!==A)j.bezierCurveTo(g,u,w,x,q,k),m+=1,o+=2;else break;i._event&&J(this[p],
j,d);L(j,i)}return this};d.fn.drawText=function t(p){var j,l,m=z(new B,p),o,q,k,g;for(j=0;j<this.length;j+=1)if(d(this[j]),l=y(this[j])){G(this[j],p,t);I(l,m);l.textBaseline=m.baseline;l.textAlign=m.align;l.font=m.font;if(!j&&m.maxWidth!==i){o=l;q=m.text;g=m.maxWidth;var u=m.text.split(" "),w=[],x="";if(o.measureText(q).width<g)w=[q];else for(;0<u.length;)o.measureText(u[0]).width>g||o.measureText(x+u[0]).width<g?x+=u.shift()+" ":(w.push(x),x=""),0===u.length&&w.push(x);o=w;o=o.join("\n").replace(/( (\n))|( $)/gi,
"$2").split("\n")}else j||(o=(""+m.text).split("\n"));ea(this[j],j,l,m,o);H(j,l,m,m.width,m.height);j||(k=m.x,"left"===m.align?k-=m.width/2:"right"===m.align&&(k+=m.width/2));for(q=0;q<o.length;q+=1)l.shadowColor=m.shadowColor,g=m.y+q*m.height/o.length-(o.length-1)*m.height/o.length/2,l.fillText(o[q],k,g),"transparent"!==m.fillStyle&&(l.shadowColor="transparent"),l.strokeText(o[q],m.x,g);m._event?(l.beginPath(),l.rect(m.x-m.width/2,m.y-m.height/2,m.width,m.height),l.restore(),J(this[j],l,p),l.closePath()):
l.restore()}E=m;return this};d.fn.measureText=function(d){var i;i=d!==A&&"object"!==typeof d?this.getLayer(d):z(new B,d);(d=y(this[0]))&&i.text!==A&&ea(this[0],0,d,i,i.text.split("\n"));return i};d.fn.drawImage=function p(d){function l(p,k,l){return function(){k||((x=u.width/u.height,g.width===i&&g.sWidth===i&&(d.width=g.width=g.sWidth=u.width),g.height===i&&g.sHeight===i&&(d.height=g.height=g.sHeight=u.height),g.width===i&&g.sWidth!==i&&(g.width=g.sWidth),g.height===i&&g.sHeight!==i&&(g.height=g.sHeight),
g.sWidth===i&&g.width!==i&&(d.sWidth=g.sWidth=u.width),g.sHeight===i&&g.height!==i&&(d.sHeight=g.sHeight=u.height),g.sx===i&&(g.sx=g.cropFromCenter?u.width/2:0),g.sy===i&&(g.sy=g.cropFromCenter?u.height/2:0),g.cropFromCenter||(g.sx+=g.sWidth/2,g.sy+=g.sHeight/2),g.sx+g.sWidth/2>u.width&&(g.sx=u.width-g.sWidth/2),0>g.sx-g.sWidth/2&&(g.sx=g.sWidth/2),0>g.sy-g.sHeight/2&&(g.sy=g.sHeight/2),g.sy+g.sHeight/2>u.height&&(g.sy=u.height-g.sHeight/2),g.width!==i&&g.height===i)?d.height=g.height=g.width/x:g.width===
i&&g.height!==i?d.width=g.width=g.height*x:g.width===i&&g.height===i&&(d.width=g.width=u.width,d.height=g.height=u.height));H(k,l,g,g.width,g.height);l.drawImage(u,g.sx-g.sWidth/2,g.sy-g.sHeight/2,g.sWidth,g.sHeight,g.x-g.width/2,g.y-g.height/2,g.width,g.height);g._event?(l.beginPath(),l.rect(g.x-g.width/2,g.y-g.height/2,g.width,g.height),l.restore(),J(m[k],l,d),l.closePath()):l.restore();g.load&&g.load.call(p,d)}}var m=this,o,q,k,g=z(new B,d),u,w,x;w=g.source.getContext;g.source.src||w?(u=g.source,
g.width=u.width,g.height=u.height):g.source&&(u=new V,u.src=g.source);for(q=0;q<m.length;q+=1)if(o=m[q],k=y(m[q]))G(m[q],d,p),I(k,g),u&&(u.complete||w?l(o,q,k)():u.onload=l(o,q,k));return m};d.fn.createPattern=d.fn.pattern=function(d){function j(){k=m.createPattern(q,o.repeat);o.load&&o.load.call(l[0],k)}var l=this,m,o=z(new B,d),q,k;(m=y(l[0]))?"function"===typeof o.source?(q=R.createElement("canvas"),q.width=o.width,q.height=o.height,d=y(q),o.source.call(q,d),j()):(d=o.source.getContext,o.source.src||
d?q=o.source:(q=new V,q.src=o.source),q.complete||d?j():q.onload=j):k=i;return k};d.fn.createGradient=d.fn.gradient=function(d){var j,d=z(new B,d),l=[],m,o,q,k,g,u,w;if(j=y(this[0])){d.x1=d.x1||0;d.y1=d.y1||0;d.x2=d.x2||0;d.y2=d.y2||0;j=d.r1!==i||d.r2!==i?j.createRadialGradient(d.x1,d.y1,d.r1,d.x2,d.y2,d.r2):j.createLinearGradient(d.x1,d.y1,d.x2,d.y2);for(k=1;d["c"+k]!==A;k+=1)d["s"+k]!==A?l.push(d["s"+k]):l.push(i);m=l.length;l[0]===i&&(l[0]=0);l[m-1]===i&&(l[m-1]=1);for(k=0;k<m;k+=1){if(l[k]!==
i){u=1;w=0;o=l[k];for(g=k+1;g<m;g+=1)if(l[g]!==i){q=l[g];break}else u+=1;o>q&&(l[g]=l[k])}else l[k]===i&&(w+=1,l[k]=o+w*((q-o)/u));j.addColorStop(l[k],d["c"+(k+1)])}}else j=i;return j};d.fn.setPixels=function j(d){var i,o,q,k=z(new B,d),g={},u,w,x,v;for(o=0;o<this.length;o+=1)if(i=this[o],q=y(i)){G(this[o],d,j);H(o,q,k,k.width,k.height);if(!k.x||!k.y||!k.width||!k.height)k.width=i.width,k.height=i.height,k.x=k.width/2,k.y=k.height/2;u=q.getImageData(k.x-k.width/2,k.y-k.height/2,k.width,k.height);
w=u.data;v=w.length;g=[];if(k.each)for(x=0;x<v;x+=4)g.r=w[x],g.g=w[x+1],g.b=w[x+2],g.a=w[x+3],k.each.call(i,g),w[x]=g.r,w[x+1]=g.g,w[x+2]=g.b,w[x+3]=g.a;q.putImageData(u,k.x-k.width/2,k.y-k.height/2);q.restore()}return this};d.fn.getCanvasImage=function(d,l){var m=this[0];return m&&m.toDataURL?m.toDataURL("image/"+d,l):i};d.support.canvas=R.createElement("canvas").getContext!==A;C.defaults=N;C.checkEvents=J;d.jCanvas=C})(jQuery,document,Image,Math,parseFloat,!0,!1,null);
